

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             WASM support for user-defined functions | Scylla Docs 
        </title>
        <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../_static/img/favicon-228x228.png" />

        
            
            
        

        
            
            <link rel="canonical" href="https://scylla.docs.scylladb.com/stable/design-notes/wasm.html"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="../"
            src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="../_static/underscore.js"></script>
            
        
            
                <script src="../_static/doctools.js"></script>
            
        
            
                <script src="../_static/clipboard.min.js"></script>
            
        
            
                <script src="../_static/copybutton.js"></script>
            
        
    
            <!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../_static/img/logo-docs.svg" alt="Scylla Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            Scylla Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>Scylla Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            Scylla Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Cloud <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://cloud.scylladb.com/">
                            <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">
                            <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
                            Docs</a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="../_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
    <div class="admonition caution">
        <p class="admonition-title">Caution</p>
        <p>
            
                You're viewing documentation for an unstable version of Scylla Dev.
            
            <a href="../../stable/design-notes/wasm.html">Switch to the latest stable version.</a>
        </p>
    </div>

                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://scylla.docs.scylladb.com"
            class="bread__highlight">
            <i class="fas fa-home"></i> Scylla Dev
        </a>
    </span>
    
        <span class="bread__item">
            <a href="index.html">
                Design Notes
            </a>
        </span>
    
    <span class="bread__item bread__item--last">WASM support for user-defined functions</span>
</div>
                    </div>
                
                <section id="wasm-support-for-user-defined-functions">
<h1>WASM support for user-defined functions<a class="headerlink" href="#wasm-support-for-user-defined-functions" title="Permalink to this headline">¶</a></h1>
<p>This document describes the details of WASM language support in user-defined functions (UDF). The language <code class="docutils literal notranslate"><span class="pre">wasm</span></code> is one of the possible languages to use, besides Lua, to implement these functions.</p>
<section id="experimental-status">
<h2>Experimental status<a class="headerlink" href="#experimental-status" title="Permalink to this headline">¶</a></h2>
<p>Before the design of WebAssembly integration and ABI is finalized, it’s only available in experimental mode.
User-defined functions are already experimental at the time of this writing, but in order to be ready
for backward incompatible changes, the language accepted by CQL is currently named “xwasm”.
Once the ABI is set in stone, it should be changed to “wasm”.</p>
</section>
<section id="abi-versions">
<h2>ABI versions<a class="headerlink" href="#abi-versions" title="Permalink to this headline">¶</a></h2>
<p>Different programming languages may require different ABIs. To support that, the wasm program is required to
export the symbol “_scylla_abi”, that is a WebAssembly global with a 32-bit value of the offset in memory,
where the version number can be read (that’s the only method of exporting a constant in Rust).</p>
<p>Currently, the only available ABI versions are 1 and 2. Both of them use the same protocol for passing
parameters and returning values, but they differ in approaches to memory management.</p>
</section>
<section id="memory-management">
<h2>Memory management<a class="headerlink" href="#memory-management" title="Permalink to this headline">¶</a></h2>
<p>The memory management differs depending on the used ABI verison:</p>
<ul class="simple">
<li><p>version 1 - There are no requirements of the usage of memory by the user. The host grows memory for each of parameters and does not free the memory in any way.</p></li>
<li><p>version 2 - The user program is required to export “_scylla_malloc” and “_scylla_free” methods, which
are then used by the host for allocating memory for parameters and freeing memory for the returned value. The user is required to free the memory allocated for parameters (this can be achieved by using
the provided helper libraries).
The “_scylla_malloc” and “_scylla_free” methods may be simple wrappers of “malloc” and “free” methods
implemented by default when compiling with WASI.</p></li>
</ul>
</section>
<section id="supported-types">
<h2>Supported types<a class="headerlink" href="#supported-types" title="Permalink to this headline">¶</a></h2>
<p>Due to the limitations imposed by WebAssembly specification, the following types can be natively supported with CQL:</p>
<ul class="simple">
<li><p>int</p></li>
<li><p>bigint</p></li>
<li><p>smallint</p></li>
<li><p>tinyint</p></li>
<li><p>bool</p></li>
<li><p>float</p></li>
<li><p>double</p></li>
</ul>
<p>The rest of CQL types (text, date, timestamp, etc.) are implemented by putting their serialized representation into wasm module memory
and passing for each parameter a 64-bit value, of which top 32 bits are its size and its bottom
32 bits are a pointer to its serialized representation, like below:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kt">int32_t</span> <span class="n">size</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">ptr</span><span class="p">;</span>
    <span class="kt">int64_t</span> <span class="n">param</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">size</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">|</span> <span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="support-for-null-values">
<h2>Support for NULL values<a class="headerlink" href="#support-for-null-values" title="Permalink to this headline">¶</a></h2>
<p>Native WebAssembly types can only be represented directly if the function does not operate on NULL values. Fortunately, user-defined functions
explicitly specify whether they accept NULL or not.</p>
<p>If the function is specified not to accept NULL, all parameters are represented
as in the description above.</p>
<p>If the function is specified to accept NULL, each parameter should be represented in WebAssembly by
size and pointer to its serialized form in memory, as in the paragraph above.</p>
<p>the important distinction is that size equal to -1 (minus one)indicates that the value is NULL and should not be parsed.</p>
</section>
<section id="return-values">
<h2>Return values<a class="headerlink" href="#return-values" title="Permalink to this headline">¶</a></h2>
<p>NOTE: ABI for return values is experimental and subject to change. It can (and should) be redesigned
after implementing helper libraries for a few popular languages (including C++, C, Rust).</p>
<p>Natively supported types are returned as is. All the other types are returned via memory, similarly to the way
they are passed as parameters: the wasm function should return a single 64-bit integer, representing the size and the offset of a serialized form of the returned value</p>
<p>Currently, returning NULL values is possible only for functions declared to be <code class="docutils literal notranslate"><span class="pre">CALLED</span> <span class="pre">ON</span> <span class="pre">NULL</span> <span class="pre">INPUT</span></code>.
For such functions, the return value is always expected to be presented in the serialized form (which
allows representing nulls), even for types natively supported by WebAssembly.
The decision is experimental and it was done in order to allow returning some values as native WebAssembly types
without having to allocate memory for them and serialize them first.
Alternative ways of expressing whether a function can <strong>return</strong> null should be considered - perhaps
as CQL syntax extension.</p>
</section>
<section id="how-to-generate-a-correct-wasm-udf-source-code">
<h2>How to generate a correct wasm UDF source code<a class="headerlink" href="#how-to-generate-a-correct-wasm-udf-source-code" title="Permalink to this headline">¶</a></h2>
<p>Scylla accepts UDF’s source code in WebAssembly text format - also known as <code class="docutils literal notranslate"><span class="pre">wat</span></code>. The source can use and define whatever’s needed for execution, including multiple helper functions and symbols. The only requirement for it to be accepted as correct UDF source is that the WebAssembly module exports a symbol with the same name as the function, and this symbol’s type is indeed a function with correct signature.</p>
<p>UDF’s source code can be, naturally, simply coded by hand in wat. It is not often very convenient to program directly in assembly, so here are a few tips.</p>
<section id="compiling-to-wasm">
<h3>Compiling to wasm<a class="headerlink" href="#compiling-to-wasm" title="Permalink to this headline">¶</a></h3>
<section id="assemblyscript">
<h4>AssemblyScript<a class="headerlink" href="#assemblyscript" title="Permalink to this headline">¶</a></h4>
<p>AssemblyScript is a TypeScript-like language that compiles to WebAsembly.</p>
<p>Install via npm:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">npm</span> <span class="n">install</span> <span class="o">-</span><span class="n">g</span> <span class="n">assemblyscript</span>
</pre></div>
</div>
<p>Example source code:</p>
<div class="highlight-assemblyscript notranslate"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kr">const</span> <span class="nx">_scylla_abi</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="kr">export</span> <span class="kd">function</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span> <span class="nx">i32</span><span class="p">)</span><span class="o">:</span> <span class="nx">i32</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">n</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Compile directly to WebAssembly Text Format with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">asc</span> <span class="n">fib</span><span class="o">.</span><span class="n">ts</span> <span class="o">--</span><span class="n">textFile</span> <span class="n">fib</span><span class="o">.</span><span class="n">wat</span> <span class="o">--</span><span class="n">optimize</span>
</pre></div>
</div>
</section>
<section id="c">
<h4>C<a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h4>
<p>Clang is capable of compiling C source code to wasm and it also supports useful built-ins
for using wasm-specific interfaces, like <code class="docutils literal notranslate"><span class="pre">__builtin_wasm_memory_size</span></code> and <code class="docutils literal notranslate"><span class="pre">__builtin_wasm_memory_grow</span></code>
for memory management.</p>
<p>Example source code:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">WASM_PAGE_SIZE</span> <span class="o">=</span> <span class="mi">64</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">_scylla_abi</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="kt">void</span><span class="o">*</span> <span class="nf">_scylla_malloc</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">_scylla_free</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">free</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">long</span> <span class="kt">long</span> <span class="nf">swap_int64</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">val</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF00FF00FF00FF00ULL</span> <span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x00FF00FF00FF00FFULL</span> <span class="p">);</span>
    <span class="n">val</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFF0000FFFF0000ULL</span> <span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0000FFFF0000FFFFULL</span> <span class="p">);</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">long</span> <span class="kt">long</span> <span class="nf">fib_aux</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">fib_aux</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib_aux</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">long</span> <span class="kt">long</span> <span class="nf">fib</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">;</span>
    <span class="kt">long</span> <span class="kt">long</span><span class="o">*</span> <span class="n">p_val</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="o">*</span><span class="p">)(</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">);</span>
    <span class="c1">// Initialize memory for the return value</span>
    <span class="kt">long</span> <span class="kt">long</span><span class="o">*</span> <span class="n">ret_val</span> <span class="o">=</span> <span class="n">_scylla_malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">ret_val</span> <span class="o">=</span> <span class="n">swap_int64</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">ret_val</span> <span class="o">=</span> <span class="n">swap_int64</span><span class="p">(</span><span class="n">fib_aux</span><span class="p">(</span><span class="n">swap_int64</span><span class="p">(</span><span class="o">*</span><span class="n">p_val</span><span class="p">)));</span>
    <span class="p">}</span>
    <span class="n">_scylla_free</span><span class="p">(</span><span class="n">p_val</span><span class="p">);</span>
    <span class="c1">// 8 is the size of a bigint</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)(</span><span class="mi">8ll</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">ret_val</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// using wasi in c/c++ requires adding a main function to the program</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){}</span>
</pre></div>
</div>
<p>Compilation instructions:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span> /path/to/wasm/supporting/c/compiler --sysroot<span class="o">=</span>/path/to/wasi/sysroot -O2  --target<span class="o">=</span>wasm32-wasi -Wl,--export<span class="o">=</span>fib -Wl,--export<span class="o">=</span>_scylla_abi -Wl,--export<span class="o">=</span>_scylla_malloc -Wl,--export<span class="o">=</span>_scylla_free -Wl,--no-entry fibnull.c -o fibnull.wasm
 wasm2wat fibnull.wasm &gt; fibnull.wat
</pre></div>
</div>
</section>
<section id="rust">
<h4>Rust<a class="headerlink" href="#rust" title="Permalink to this headline">¶</a></h4>
<p>Rust ecosystem exposes a rather convenient way of generating WebAssembly, with the help of <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">wasi</span></code> and <code class="docutils literal notranslate"><span class="pre">wasm_bindgen</span></code>.</p>
<p>As a short example, here’s a sample Rust code which can be compiled to WebAssembly:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">wasm_bindgen</span>::<span class="n">prelude</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>

<span class="cp">#[no_mangle]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">_scylla_abi</span>: <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="cp">#[wasm_bindgen]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">n</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>A more detailed guide and examples can be found here:
https://bytecodealliance.github.io/cargo-wasi/hello-world.html
https://rustwasm.github.io/wasm-bindgen/</p>
</section>
</section>
<section id="generating-wat-from-wasm">
<h3>Generating wat from wasm<a class="headerlink" href="#generating-wat-from-wasm" title="Permalink to this headline">¶</a></h3>
<p>For those who want to use precompiled WASM modules, it’s enough to translate WASM bytecode to <code class="docutils literal notranslate"><span class="pre">wat</span></code> representation. On Linux, it can be achieved by a <code class="docutils literal notranslate"><span class="pre">wasm2wat</span></code> tool, available in most distributions in the <code class="docutils literal notranslate"><span class="pre">wabt</span></code> package.</p>
</section>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Here’s how a <code class="docutils literal notranslate"><span class="pre">wasm</span></code> function can be declared:</p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">ks</span><span class="mf">.</span><span class="n">fib</span> <span class="p">(</span><span class="k">input</span> <span class="nb">bigint</span><span class="p">)</span> <span class="k">RETURNS</span> <span class="k">NULL</span> <span class="k">ON</span> <span class="k">NULL</span> <span class="k">INPUT</span> <span class="k">RETURNS</span> <span class="nb">bigint</span> <span class="k">LANGUAGE</span> <span class="n">xwasm</span>
<span class="k">AS</span> <span class="s1">&#39;(module</span>
<span class="s1">  (func $fib (param $n i64) (result i64)</span>
<span class="s1">    (if</span>
<span class="s1">      (i64.lt_s (local.get $n) (i64.const 2))</span>
<span class="s1">      (return (local.get $n))</span>
<span class="s1">    )</span>
<span class="s1">    (i64.add</span>
<span class="s1">      (call $fib (i64.sub (local.get $n) (i64.const 1)))</span>
<span class="s1">      (call $fib (i64.sub (local.get $n) (i64.const 2)))</span>
<span class="s1">    )</span>
<span class="s1">  )</span>
<span class="s1">  (export &quot;fib&quot; (func $fib))</span>
<span class="s1">  (global (;0;) i32 (i32.const 1024))</span>
<span class="s1">  (export &quot;_scylla_abi&quot; (global 0))</span>
<span class="s1">  (data $.rodata (i32.const 1024) &quot;\\01&quot;)</span>
<span class="s1">)&#39;</span>
</pre></div>
</div>
<p>and it can be invoked just like a regular UDF:</p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span> <span class="nb">bigint</span><span class="p">,</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">n</span><span class="p">));</span>
<span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">);</span>
<span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">);</span>
<span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">2</span><span class="p">);</span>
<span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">3</span><span class="p">);</span>
<span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">4</span><span class="p">);</span>
<span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">5</span><span class="p">);</span>
<span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">6</span><span class="p">);</span>
<span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">7</span><span class="p">);</span>
<span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">8</span><span class="p">);</span>
<span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">9</span><span class="p">);</span>
<span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">10</span><span class="p">);</span>
<span class="n">scylla</span><span class="o">@</span><span class="n">cqlsh</span><span class="p">:</span><span class="n">ks</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">n</span><span class="p">,</span> <span class="n">ks</span><span class="mf">.</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">t</span><span class="p">;</span>

 <span class="n">n</span>  <span class="o">|</span> <span class="n">ks</span><span class="mf">.</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c1">----+-----------</span>
  <span class="mf">0</span> <span class="o">|</span>         <span class="mf">0</span>
  <span class="mf">1</span> <span class="o">|</span>         <span class="mf">1</span>
  <span class="mf">2</span> <span class="o">|</span>         <span class="mf">1</span>
  <span class="mf">3</span> <span class="o">|</span>         <span class="mf">2</span>
  <span class="mf">4</span> <span class="o">|</span>         <span class="mf">3</span>
  <span class="mf">5</span> <span class="o">|</span>         <span class="mf">5</span>
  <span class="mf">6</span> <span class="o">|</span>         <span class="mf">8</span>
  <span class="mf">7</span> <span class="o">|</span>        <span class="mf">13</span>
  <span class="mf">8</span> <span class="o">|</span>        <span class="mf">21</span>
  <span class="mf">9</span> <span class="o">|</span>        <span class="mf">34</span>
 <span class="mf">10</span> <span class="o">|</span>        <span class="mf">55</span>

<span class="p">(</span><span class="mf">11</span> <span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>

                
                    <div class="post-content"><div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="system_schema_keyspace.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />System schema keyspace layout
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="../guides/index.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Guides
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div></div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__versions">
    <ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
        <li class="scylla-dropdown__item">
            <a class="scylla-dropdown__title" href="#">
                
                    master
                
                <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
            </a>
            <ul class="menu scylla-dropdown__content">
                
                    
                
                    
                        <li>
                            <a href="../../stable/design-notes/wasm.html">4.6</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../branch-4.5/index.html">4.5</a>
                        </li>
                    
                
                
            </ul>
        </li>
    </ul>
</div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Scylla Developer Documentation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../alternator/alternator.html">Alternator: DynamoDB API in Scylla</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../alternator/getting-started.html">Getting Started With ScyllaDB Alternator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alternator/compatibility.html">Scylla Alternator for DynamoDB users</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Design Notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="IDL.html">IDL compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdc.html">CDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="compaction_controller.html">The Compaction Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql-extensions.html">Scylla CQL extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql-extensions-internal.html">Scylla CQL extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql3-type-mapping.html">CQL3 Type Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="hinted_handoff_design.html">Hinted Handoff Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="isolation.html">Performance Isolation in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="lua-type-mapping.html">CQL to Lua type mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">Scylla Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-users-to-roles.html">Migrating from users to roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="paged-queries.html">Paged queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_aggregations.html">Parallel aggregations</a></li>
<li class="toctree-l2"><a class="reference internal" href="per-partition-rate-limit.html">Per-partition rate limiting</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocol-extensions.html">Protocol extensions to the Cassandra Native Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocols.html">Ports and protocols in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft-in-scylla.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft-in-scylla.html#raft-application-in-scylla">Raft application in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft-in-scylla.html#the-group-0">The group 0</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft-in-scylla.html#using-group-0-to-perform-schema-changes">Using Group 0 to perform schema changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="redis.html">Redis API in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="repair_based_node_ops.html">Repair based node operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="reverse-reads.html">Reverse reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="row_cache.html">Row Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="row_level_repair.html">Row level repair</a></li>
<li class="toctree-l2"><a class="reference internal" href="rust.html">Rust and C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="secondary_index.html">Secondary indexes in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="service_levels.html">Service Level Distributed Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstable-scylla-format.html">File format of the Scylla.db sstable component</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstables-directory-structure.html">sstables directory structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_keyspace.html">System keyspace layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_keyspace.html#virtual-tables-in-the-system-keyspace">Virtual tables in the system keyspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_schema_keyspace.html">System schema keyspace layout</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">WASM support for user-defined functions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../guides/index.html">Guides</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/api_v2.html">Scylla RESTful API V2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/building.html">Building Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/debugging.html">Debugging with GDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/docker-hub.html">Docker Hub Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/logging.html">Logging in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/virtual-tables.html">Virtual Tables</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contribute/index.html">Contribute</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../contribute/CONTRIBUTING.html">Contributing to Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/backport.html">Backport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/maintainer.html">Maintainer’s handbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/review-checklist.html">Review Checklist</a></li>
</ul>
</li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/scylla/issues/new?title=Issue in page WASM support for user-defined functions&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://scylla.docs.scylladb.com/master/design-notes/wasm%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                
                
                    
                        
                    
                
                <a href="https://github.com/scylladb/scylla/edit/master/docs/design-notes/wasm.md"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">WASM support for user-defined functions</a><ul>
<li><a class="reference internal" href="#experimental-status">Experimental status</a></li>
<li><a class="reference internal" href="#abi-versions">ABI versions</a></li>
<li><a class="reference internal" href="#memory-management">Memory management</a></li>
<li><a class="reference internal" href="#supported-types">Supported types</a></li>
<li><a class="reference internal" href="#support-for-null-values">Support for NULL values</a></li>
<li><a class="reference internal" href="#return-values">Return values</a></li>
<li><a class="reference internal" href="#how-to-generate-a-correct-wasm-udf-source-code">How to generate a correct wasm UDF source code</a><ul>
<li><a class="reference internal" href="#compiling-to-wasm">Compiling to wasm</a><ul>
<li><a class="reference internal" href="#assemblyscript">AssemblyScript</a></li>
<li><a class="reference internal" href="#c">C</a></li>
<li><a class="reference internal" href="#rust">Rust</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generating-wat-from-wasm">Generating wat from wasm</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="../_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="../_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="../_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2022, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 28 June 2022.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.2.2</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>