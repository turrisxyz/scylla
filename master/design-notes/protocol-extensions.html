

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Protocol extensions to the Cassandra Native Protocol | Scylla Docs 
        </title>
        <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../_static/img/favicon-228x228.png" />

        
            
            
        

        
            
            <link rel="canonical" href="https://scylla.docs.scylladb.com/stable/design-notes/protocol-extensions.html"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="../"
            src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="../_static/underscore.js"></script>
            
        
            
                <script src="../_static/doctools.js"></script>
            
        
            
                <script src="../_static/clipboard.min.js"></script>
            
        
            
                <script src="../_static/copybutton.js"></script>
            
        
    
            <!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../_static/img/logo-docs.svg" alt="Scylla Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            Scylla Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>Scylla Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            Scylla Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Cloud <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://cloud.scylladb.com/">
                            <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">
                            <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
                            Docs</a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="../_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
    <div class="admonition caution">
        <p class="admonition-title">Caution</p>
        <p>
            
                You're viewing documentation for an unstable version of Scylla Dev.
            
            <a href="../../stable/design-notes/protocol-extensions.html">Switch to the latest stable version.</a>
        </p>
    </div>

                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://scylla.docs.scylladb.com"
            class="bread__highlight">
            <i class="fas fa-home"></i> Scylla Dev
        </a>
    </span>
    
        <span class="bread__item">
            <a href="index.html">
                Design Notes
            </a>
        </span>
    
    <span class="bread__item bread__item--last">Protocol extensions to the Cassandra Native Protocol</span>
</div>
                    </div>
                
                <section id="protocol-extensions-to-the-cassandra-native-protocol">
<h1>Protocol extensions to the Cassandra Native Protocol<a class="headerlink" href="#protocol-extensions-to-the-cassandra-native-protocol" title="Permalink to this headline">¶</a></h1>
<p>This document specifies extensions to the protocol defined
by Cassandra’s native_protocol_v4.spec and native_protocol_v5.spec.
The extensions are designed so that a driver supporting them can
continue to interoperate with Cassandra and other compatible servers
with no configuration needed; the driver can discover the extensions
and enable them conditionally.</p>
<p>An extension can be discovered by the client driver by using the OPTIONS
request; the returned SUPPORTED response will have zero or more options
beginning with <code class="docutils literal notranslate"><span class="pre">SCYLLA</span></code> indicating extensions defined in this document, in
addition to options documented by Cassandra. How to use the extension
is further explained in this document.</p>
<section id="extending-protocol-extensions-support">
<h2>Extending protocol extensions support<a class="headerlink" href="#extending-protocol-extensions-support" title="Permalink to this headline">¶</a></h2>
<p>As mentioned above, in order to use a protocol extension feature by both
server and client, they need to negotiate the used feature set when establishing
a connection.</p>
<p>The negotiation procedure has the following steps:</p>
<ul class="simple">
<li><p>Client sends the OPTIONS request to the Scylla instance to get a list of
protocol extensions that the server understands.</p></li>
<li><p>Server sends the SUPPORTED message in reply to the OPTIONS request. The
message body is a string multimap, in which keys describe different
extensions and possibly one or more additional values specific to a
particular extension (specified as distinct values under a feature key in
the following form: <code class="docutils literal notranslate"><span class="pre">ARG_NAME=VALUE</span></code>).</p></li>
<li><p>The client determines the set of compatible extensions which it is going
to use in the current connection by intersecting known capabilities list
with what it has received in SUPPORTED response.</p></li>
<li><p>Client driver sends the STARTUP request with additional payload consisting
of key-value pairs, each describing a negotiated extension.</p></li>
<li><p>Server determines the set of compatible extensions by intersecting known
list of protocol extensions with what it has received in STARTUP request.</p></li>
</ul>
<p>Both client and server use the same string identifiers for the keys to determine
negotiated extension set, judging by the presence of a particular key in the
SUPPORTED/STARTUP messages.</p>
</section>
<section id="intranode-sharding">
<h2>Intranode sharding<a class="headerlink" href="#intranode-sharding" title="Permalink to this headline">¶</a></h2>
<p>This extension allows the driver to discover how Scylla internally
partitions data among logical cores. It can then create at least
one connection per logical core, and send queries directly to the
logical core that will serve them, greatly improving load balancing
and efficiency.</p>
<p>To use the extension, send the OPTIONS message. The data is returned
in the SUPPORTED message, as a set of key/value options. Numeric values
are returned as their base-10 ASCII representation.</p>
<p>The keys and values are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SCYLLA_SHARD</span></code> is an integer, the zero-based shard number this connection
is connected to (for example, <code class="docutils literal notranslate"><span class="pre">3</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCYLLA_NR_SHARDS</span></code> is an integer containing the number of shards on this
node (for example, <code class="docutils literal notranslate"><span class="pre">12</span></code>). All shard numbers are smaller than this number.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCYLLA_PARTITIONER</span></code> is a the fully-qualified name of the partitioner in use (i.e.
<code class="docutils literal notranslate"><span class="pre">org.apache.cassandra.partitioners.Murmur3Partitioner</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCYLLA_SHARDING_ALGORITHM</span></code> is the name of an algorithm used to select how
partitions are mapped into shards (described below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCYLLA_SHARDING_IGNORE_MSB</span></code> is an integer parameter to the algorithm (also
described below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCYLLA_SHARD_AWARE_PORT</span></code> is an additional port number where Scylla is listening
for CQL connections. If present, it works almost the same way as port 9042 typically
does; the difference is that client-side port number is used as an indicator to which
shard client wants to connect. The desired shard number is calculated as:
<code class="docutils literal notranslate"><span class="pre">desired_shard_no</span> <span class="pre">=</span> <span class="pre">client_port</span> <span class="pre">%</span> <span class="pre">SCYLLA_NR_SHARDS</span></code>. Its value is a decimal
representation of type <code class="docutils literal notranslate"><span class="pre">uint16_t</span></code>, by default <code class="docutils literal notranslate"><span class="pre">19042</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCYLLA_SHARD_AWARE_PORT_SSL</span></code> is an additional port number where Scylla is
listening for encrypted CQL connections. If present, it works almost the same way
as port 9142 typically does; the difference is that client-side port number is used
as an indicator to which shard client wants to connect. The desired shard number
is calculated as: <code class="docutils literal notranslate"><span class="pre">desired_shard_no</span> <span class="pre">=</span> <span class="pre">client_port</span> <span class="pre">%</span> <span class="pre">SCYLLA_NR_SHARDS</span></code>.
Its value is a decimal representation of type <code class="docutils literal notranslate"><span class="pre">uint16_t</span></code>, by default <code class="docutils literal notranslate"><span class="pre">19142</span></code>.</p></li>
</ul>
<p>Currently, one <code class="docutils literal notranslate"><span class="pre">SCYLLA_SHARDING_ALGORITHM</span></code> is defined,
<code class="docutils literal notranslate"><span class="pre">biased-token-round-robin</span></code>. To apply the algorithm,
perform the following steps (assuming infinite-precision arithmetic):</p>
<ul class="simple">
<li><p>subtract the minimum token value from the partition’s token
in order to bias it: <code class="docutils literal notranslate"><span class="pre">biased_token</span> <span class="pre">=</span> <span class="pre">token</span> <span class="pre">-</span> <span class="pre">(-2**63)</span></code></p></li>
<li><p>shift <code class="docutils literal notranslate"><span class="pre">biased_token</span></code> left by <code class="docutils literal notranslate"><span class="pre">ignore_msb</span></code> bits, discarding any
bits beyond the 63rd:
<code class="docutils literal notranslate"><span class="pre">biased_token</span> <span class="pre">=</span> <span class="pre">(biased_token</span> <span class="pre">&lt;&lt;</span> <span class="pre">SCYLLA_SHARDING_IGNORE_MSB)</span> <span class="pre">%</span> <span class="pre">(2**64)</span></code></p></li>
<li><p>multiply by <code class="docutils literal notranslate"><span class="pre">SCYLLA_NR_SHARDS</span></code> and perform a truncating division by 2**64:
<code class="docutils literal notranslate"><span class="pre">shard</span> <span class="pre">=</span> <span class="pre">(biased_token</span> <span class="pre">*</span> <span class="pre">SCYLLA_NR_SHARDS)</span> <span class="pre">/</span> <span class="pre">2**64</span></code></p></li>
</ul>
<p>(this apparently convoluted algorithm replaces a slow division instruction with
a fast multiply instruction).</p>
<p>in C with 128-bit arithmetic support, these operations can be efficiently
performed in three steps:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>    <span class="kt">uint64_t</span> <span class="n">biased_token</span> <span class="o">=</span> <span class="n">token</span> <span class="o">+</span> <span class="p">((</span><span class="kt">uint64_t</span><span class="p">)</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">63</span><span class="p">);</span>
    <span class="n">biased_token</span> <span class="o">&lt;&lt;=</span> <span class="n">ignore_msb</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">shard</span> <span class="o">=</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="n">__int128</span><span class="p">)</span><span class="n">biased_token</span> <span class="o">*</span> <span class="n">nr_shards</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">64</span><span class="p">;</span>
</pre></div>
</div>
<p>In languages without 128-bit arithmetic support, use the following (this example
is for Java):</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span>    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">scyllaShardOf</span><span class="o">(</span><span class="kt">long</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">token</span> <span class="o">+=</span> <span class="n">Long</span><span class="o">.</span><span class="na">MIN_VALUE</span><span class="o">;</span>
        <span class="n">token</span> <span class="o">&lt;&lt;=</span> <span class="n">ignoreMsb</span><span class="o">;</span>
        <span class="kt">long</span> <span class="n">tokLo</span> <span class="o">=</span> <span class="n">token</span> <span class="o">&amp;</span> <span class="mh">0xffffffffL</span><span class="o">;</span>
        <span class="kt">long</span> <span class="n">tokHi</span> <span class="o">=</span> <span class="o">(</span><span class="n">token</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">32</span><span class="o">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffffL</span><span class="o">;</span>
        <span class="kt">long</span> <span class="n">mul1</span> <span class="o">=</span> <span class="n">tokLo</span> <span class="o">*</span> <span class="n">nrShards</span><span class="o">;</span>
        <span class="kt">long</span> <span class="n">mul2</span> <span class="o">=</span> <span class="n">tokHi</span> <span class="o">*</span> <span class="n">nrShards</span><span class="o">;</span>
        <span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="o">(</span><span class="n">mul1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">32</span><span class="o">)</span> <span class="o">+</span> <span class="n">mul2</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)(</span><span class="n">sum</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">32</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div>
</div>
<p>It is recommended that drivers open connections until they have at
least one connection per shard, then close excess connections.</p>
</section>
<section id="lwt-prepared-statements-metadata-mark">
<h2>LWT prepared statements metadata mark<a class="headerlink" href="#lwt-prepared-statements-metadata-mark" title="Permalink to this headline">¶</a></h2>
<p>This extension allows the driver to discover whether LWT statements have a
special bit set in prepared statement metadata flags, which indicates that
the driver currently deals with an LWT statement.</p>
<p>Having a designated flag gives the ability to reliably detect LWT statements
and remove the need to execute custom parsing logic for each query, which is not
only costly but also error-prone (e.g. parsing the prepared query with regular
expressions).</p>
<p>The feature is meant to be further utilized by client drivers to use primary
replicas consistently when dealing with conditional statements.</p>
<p>Choosing primary replicas in a predefined order ensures that in case of multiple
LWT queries that contend on a single key, these queries will queue up at the
replica rather than compete: choose the primary replica first, then, if the
primary is known to be down, the first secondary, then the second secondary, and
so on.
This will reduce contention over hot keys and thus increase LWT performance.</p>
<p>The feature is identified by the <code class="docutils literal notranslate"><span class="pre">SCYLLA_LWT_ADD_METADATA_MARK</span></code> key that is
meant to be sent in the SUPPORTED message along with the following additional
parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SCYLLA_LWT_OPTIMIZATION_META_BIT_MASK</span></code> is a 32-bit unsigned integer that represents
the bit mask that should be used by the client to test against when checking
prepared statement metadata flags to see if the current query is conditional
or not.</p></li>
</ul>
</section>
<section id="rate-limit-error">
<h2>Rate limit error<a class="headerlink" href="#rate-limit-error" title="Permalink to this headline">¶</a></h2>
<p>This extension allows the driver to send a new type of error in case the operation
goes over the allowed per-partition rate limit. This kind of error does not fit
other existing error codes well, hence the need for the protocol extension.</p>
<p>On receiving this error, the driver should not retry the request; instead,
the error should be propagated to the user so that they can decide what to do
with it - sometimes it might make sense to propagate the error, in other cases
it might make sense to retry with backoff.</p>
<p>The body of the error consists of the usual error code, error message and then
the following fields: <code class="docutils literal notranslate"><span class="pre">&lt;op_type&gt;&lt;rejected_by_coordinator&gt;</span></code>, where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">op_type</span></code> is a byte which identifies the operation which is the origin
of the rate limit.</p>
<ul>
<li><p>0: read</p></li>
<li><p>1: write</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">rejected_by_coordinator</span></code> is a byte which is 1 if the operation was rejected
on the coordinator and 0 if it was rejected by replicas.</p></li>
</ul>
<p>If the driver does not understand this extension and does not enable it,
the Config_error will be used instead of the new error code.</p>
<p>In order to be forward compatible with error codes added in the future protocol
versions, this extension doesn’t reserve a fixed error code - instead, it
advertises the integer value used as the error code in the SUPPORTED response.</p>
<p>This extension is identified by the <code class="docutils literal notranslate"><span class="pre">SCYLLA_RATE_LIMIT_ERROR</span></code> key.
The string map in the SUPPORTED response will contain the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR_CODE</span></code>: a 32-bit signed decimal integer which Scylla
will use as the error code for the rate limit exception.</p></li>
</ul>
</section>
</section>

                
                    <div class="post-content"><div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="per-partition-rate-limit.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Per-partition rate limiting
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="protocols.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Ports and protocols in Scylla
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div></div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__versions">
    <ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
        <li class="scylla-dropdown__item">
            <a class="scylla-dropdown__title" href="#">
                
                    master
                
                <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
            </a>
            <ul class="menu scylla-dropdown__content">
                
                    
                
                    
                        <li>
                            <a href="../../stable/design-notes/protocol-extensions.html">4.6</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../branch-4.5/design-notes/protocol-extensions.html">4.5</a>
                        </li>
                    
                
                
            </ul>
        </li>
    </ul>
</div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Scylla Developer Documentation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../alternator/alternator.html">Alternator: DynamoDB API in Scylla</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../alternator/getting-started.html">Getting Started With ScyllaDB Alternator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alternator/compatibility.html">Scylla Alternator for DynamoDB users</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Design Notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="IDL.html">IDL compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdc.html">CDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="compaction_controller.html">The Compaction Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql-extensions.html">Scylla CQL extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql-extensions-internal.html">Scylla CQL extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql3-type-mapping.html">CQL3 Type Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="hinted_handoff_design.html">Hinted Handoff Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="isolation.html">Performance Isolation in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="lua-type-mapping.html">CQL to Lua type mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">Scylla Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-users-to-roles.html">Migrating from users to roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="paged-queries.html">Paged queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_aggregations.html">Parallel aggregations</a></li>
<li class="toctree-l2"><a class="reference internal" href="per-partition-rate-limit.html">Per-partition rate limiting</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Protocol extensions to the Cassandra Native Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocols.html">Ports and protocols in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft-in-scylla.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft-in-scylla.html#raft-application-in-scylla">Raft application in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft-in-scylla.html#the-group-0">The group 0</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft-in-scylla.html#using-group-0-to-perform-schema-changes">Using Group 0 to perform schema changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="redis.html">Redis API in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="repair_based_node_ops.html">Repair based node operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="reverse-reads.html">Reverse reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="row_cache.html">Row Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="row_level_repair.html">Row level repair</a></li>
<li class="toctree-l2"><a class="reference internal" href="rust.html">Rust and C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="secondary_index.html">Secondary indexes in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="service_levels.html">Service Level Distributed Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstable-scylla-format.html">File format of the Scylla.db sstable component</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstables-directory-structure.html">sstables directory structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_keyspace.html">System keyspace layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_keyspace.html#virtual-tables-in-the-system-keyspace">Virtual tables in the system keyspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_schema_keyspace.html">System schema keyspace layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="wasm.html">WASM support for user-defined functions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../guides/index.html">Guides</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/api_v2.html">Scylla RESTful API V2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/building.html">Building Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/debugging.html">Debugging with GDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/docker-hub.html">Docker Hub Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/logging.html">Logging in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/virtual-tables.html">Virtual Tables</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contribute/index.html">Contribute</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../contribute/CONTRIBUTING.html">Contributing to Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/backport.html">Backport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/maintainer.html">Maintainer’s handbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/review-checklist.html">Review Checklist</a></li>
</ul>
</li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/scylla/issues/new?title=Issue in page Protocol extensions to the Cassandra Native Protocol&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://scylla.docs.scylladb.com/master/design-notes/protocol-extensions%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                
                
                    
                        
                    
                
                <a href="https://github.com/scylladb/scylla/edit/master/docs/design-notes/protocol-extensions.md"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Protocol extensions to the Cassandra Native Protocol</a><ul>
<li><a class="reference internal" href="#extending-protocol-extensions-support">Extending protocol extensions support</a></li>
<li><a class="reference internal" href="#intranode-sharding">Intranode sharding</a></li>
<li><a class="reference internal" href="#lwt-prepared-statements-metadata-mark">LWT prepared statements metadata mark</a></li>
<li><a class="reference internal" href="#rate-limit-error">Rate limit error</a></li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="../_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="../_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="../_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2022, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 28 June 2022.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.2.2</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>