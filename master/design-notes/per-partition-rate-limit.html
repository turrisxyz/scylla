

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Per-partition rate limiting | Scylla Docs 
        </title>
        <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../_static/img/favicon-228x228.png" />

        
            
            
        

        
            
            <link rel="canonical" href="https://scylla.docs.scylladb.com/stable/design-notes/per-partition-rate-limit.html"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="../"
            src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="../_static/underscore.js"></script>
            
        
            
                <script src="../_static/doctools.js"></script>
            
        
            
                <script src="../_static/clipboard.min.js"></script>
            
        
            
                <script src="../_static/copybutton.js"></script>
            
        
    
            <!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../_static/img/logo-docs.svg" alt="Scylla Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            Scylla Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>Scylla Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            Scylla Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Cloud <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://cloud.scylladb.com/">
                            <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">
                            <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
                            Docs</a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="../_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
    <div class="admonition caution">
        <p class="admonition-title">Caution</p>
        <p>
            
                You're viewing documentation for an unstable version of Scylla Dev.
            
            <a href="../../stable/index.html">Switch to the latest stable version.</a>
        </p>
    </div>

                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://scylla.docs.scylladb.com"
            class="bread__highlight">
            <i class="fas fa-home"></i> Scylla Dev
        </a>
    </span>
    
        <span class="bread__item">
            <a href="index.html">
                Design Notes
            </a>
        </span>
    
    <span class="bread__item bread__item--last">Per-partition rate limiting</span>
</div>
                    </div>
                
                <section id="per-partition-rate-limiting">
<h1>Per-partition rate limiting<a class="headerlink" href="#per-partition-rate-limiting" title="Permalink to this headline">¶</a></h1>
<p>Scylla clusters operate best when the data is spread across a large number
of small partitions, and reads/writes are spread uniformly across all shards
and nodes. Due to various reasons (bugs, malicious end users etc.) this
assumption may suddenly not hold anymore and one partition may start getting
a disproportionate number of requests. In turn, this usually leads to the owning
shards being overloaded - a scenario called “hot partition” - and the total
cluster latency becoming worse.</p>
<p>The <em>per partition rate limit</em> feature allows users to limit the rate
of accepted requests on a per-partition basis. When a partition exceeds
the configured limit of operations of given type (reads/writes) per second,
the cluster will start responding with errors to some of the operations for that
partition so that, statistically, the rate of accepted requests is kept
at the configured limit. Rejected operations use less resources, therefore
this feature can help in the “hot partition” situation.</p>
<p><em>NOTE</em>: this is an overload protection mechanism and may not be used to reliably
enforce limits in some situations. Due to Scylla’s distributed nature,
the actual number of accepted requests depends on the cluster and driver
configuration and may be larger by a factor of RF (keyspace’s replication
factor). It is recommended to set the limit to a value an order of magnitude
larger than the maximum expected per-partition throughput. See the
<a class="reference external" href="#inaccurracies">Inaccurracies</a> section for more information.</p>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<section id="server-side-configuration">
<h3>Server-side configuration<a class="headerlink" href="#server-side-configuration" title="Permalink to this headline">¶</a></h3>
<p>Per-partition limits are set separately for reads and writes, on a per-table
basis. Limits can be set with the <code class="docutils literal notranslate"><span class="pre">per_partition_rate_limit</span></code> extension when
CREATE’ing or ALTER’ing a table using a schema extension:</p>
<div class="highlight-cql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">ks</span><span class="mf">.</span><span class="n">tbl</span> <span class="k">WITH</span> <span class="n">per_partition_rate_limit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;max_reads_per_second&#39;</span><span class="p">:</span> <span class="mf">123</span><span class="p">,</span>
    <span class="s1">&#39;max_writes_per_second&#39;</span><span class="p">:</span> <span class="mf">456</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Both <code class="docutils literal notranslate"><span class="pre">max_reads_per_second</span></code> and <code class="docutils literal notranslate"><span class="pre">max_writes_per_second</span></code> are optional - omitting
one of them means “no limit” for that type of operation.</p>
</section>
<section id="driver-response">
<h3>Driver response<a class="headerlink" href="#driver-response" title="Permalink to this headline">¶</a></h3>
<p>Rejected operations are reported as an ERROR response to the driver.
If the driver supports it, the response contains a scylla-specific error code
indicating that the operation was rejected. For more details about the error
code, see the <a class="reference external" href="./protocol-extensions.md#Rate%20limit%20error">Rate limit error</a>
section in the <code class="docutils literal notranslate"><span class="pre">protocol-extensions.md</span></code> doc.</p>
<p>If the driver doesn’t support the new error code, the <code class="docutils literal notranslate"><span class="pre">Config_error</span></code> code
is returned instead. The code was chosen in order for the retry policies
of the drivers not to retry the requests and instead propagate them directly
to the users.</p>
</section>
</section>
<section id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p>Accounting related to tracking per-partition limits is done by replicas.
Each replica keeps a map of counters which are identified by a combination
of (token, table, operation type). When the replica accounts an operation,
it increments the relevant counter. All counters are halved every second.</p>
<p>Depending on whether the coordinator is a replica or not, the flow is
a bit different. Here, “coordinator == replica” requirement also means
that the operation is handled on the correct shard.</p>
<p>Only reads and writes explicitly issued by the user are counted to the limit.
Read repair, hints, batch replay, CDC preimage query and internal system queries
are <em>not</em> counted to the limit.</p>
<p>Paxos and counters are not covered in current implemenation.</p>
<section id="coordinator-is-not-a-replica">
<h3>Coordinator is not a replica<a class="headerlink" href="#coordinator-is-not-a-replica" title="Permalink to this headline">¶</a></h3>
<p>Coordinator generates a random number from range <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1)</span></code> with uniform
distribution and sends it to replicas along with the operation request.
Each replica accounts the operation and then calculates a rejection threshold
based on the local counter value. If the number received from the coordinator
is above the threshold, the operation is rejected.</p>
<p>The assumption is that all replicas will converge to similar counter values.
Most of the time they will agree on the decision and not much work
will be wasted due to some replicas accepting and other rejecting.</p>
</section>
<section id="coordinator-is-a-replica">
<h3>Coordinator is a replica<a class="headerlink" href="#coordinator-is-a-replica" title="Permalink to this headline">¶</a></h3>
<p>As before, the coordinator generates a random number. However, it does not
send requests to replicas immediately but rather calculates local rejection
threshold. If the number is above threshold, the whole operation is skipped
and the operation is only accounted on the coordinator. Otherwise, coordinator
proceeds with sending the requests, and replicas are told only to account
the operation but never reject it.</p>
<p>This strategy leads to no wasted replica work. However, when the coordinator
rejects the operation other replicas do not account it, so it may lead to
a bit more requests being accepted (but still not more than <code class="docutils literal notranslate"><span class="pre">RF</span> <span class="pre">*</span> <span class="pre">limit</span></code>).</p>
</section>
<section id="how-to-calculate-rejection-threshold">
<h3>How to calculate rejection threshold<a class="headerlink" href="#how-to-calculate-rejection-threshold" title="Permalink to this headline">¶</a></h3>
<p>Let’s assume the simplest case where there is only one replica. It will
increment its counter on every operation. Because all counters are halved
every second, assuming the rate of <code class="docutils literal notranslate"><span class="pre">V</span></code> ops/s the counter will eventually
oscillate between <code class="docutils literal notranslate"><span class="pre">V</span></code> and <code class="docutils literal notranslate"><span class="pre">2V</span></code>. If the limit is <code class="docutils literal notranslate"><span class="pre">L</span></code> ops/s, then we would
like to admit only <code class="docutils literal notranslate"><span class="pre">L</span></code> operation within each second - therefore the probability
should satisfy the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">L</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">V</span><span class="o">..</span><span class="mi">2</span><span class="n">V</span><span class="p">)</span> <span class="p">{</span> <span class="n">P</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>This can be approximated with a definite integral:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">L</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">V</span><span class="o">..</span><span class="mi">2</span><span class="n">V</span><span class="p">)</span> <span class="p">{</span> <span class="n">P</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>A solution to this integral is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">P</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">ln</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">x</span></code> is the current value of the counter. This is the formula used
in the current implementation.</p>
</section>
<section id="inaccurracies">
<h3>Inaccurracies<a class="headerlink" href="#inaccurracies" title="Permalink to this headline">¶</a></h3>
<p>In practice, RF is rarely 1 so there is more than one replica. Depending on
the type of the operation, this introduces some inaccurracies in counting.</p>
<ul class="simple">
<li><p>Writes are counted relatively well because all live replicas participate
in a write operation, so all replicas should have an up-to-date counter
value. Because of the “coordinator is replica” case, rejected writes
will not be accounted on all replicas. In tests, the amount of accepted
operations was quite close to the limit and much less than the theoretical
<code class="docutils literal notranslate"><span class="pre">RF</span> <span class="pre">*</span> <span class="pre">limit</span></code>.</p></li>
<li><p>Reads are less accurate because not all replicas may participate in a given
read operation (this depends on CL). In the worst case of CL=ONE and
round-robin strategy, up to <code class="docutils literal notranslate"><span class="pre">RF</span> <span class="pre">*</span> <span class="pre">limit</span></code> ops/s will be accepted. Higher
consistencies are counted better, e.g. CL=ALL - although they are also
susceptible to the inaccurracy introduced by “coordinator is replica” case.</p></li>
<li><p>In case of non-shard-aware drivers, it is best to keep the clocks in sync.
When the coordinator is not a replica, each replica decides whether to accept
or not, based on the random number sent by coordinator. If the replicas have
their clocks in sync, then their per-partition counters should have close
values and they will agree on the decision whether to reject or not most of
the time. If not, they will disagree more frequently which will result in
wasted replica work and the effective rate limit will be lower or higher,
depending on the consistency. In the worst case, it might be 30% lower or
45% higher than the real limit.</p></li>
</ul>
</section>
</section>
</section>

                
                    <div class="post-content"><div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="parallel_aggregations.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Parallel aggregations
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="protocol-extensions.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Protocol extensions to the Cassandra Native Protocol
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div></div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__versions">
    <ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
        <li class="scylla-dropdown__item">
            <a class="scylla-dropdown__title" href="#">
                
                    master
                
                <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
            </a>
            <ul class="menu scylla-dropdown__content">
                
                    
                
                    
                        <li>
                            <a href="../../stable/index.html">4.6</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../branch-4.5/index.html">4.5</a>
                        </li>
                    
                
                
            </ul>
        </li>
    </ul>
</div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Scylla Developer Documentation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../alternator/alternator.html">Alternator: DynamoDB API in Scylla</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../alternator/getting-started.html">Getting Started With ScyllaDB Alternator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alternator/compatibility.html">Scylla Alternator for DynamoDB users</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Design Notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="IDL.html">IDL compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdc.html">CDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="compaction_controller.html">The Compaction Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql-extensions.html">Scylla CQL extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql-extensions-internal.html">Scylla CQL extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql3-type-mapping.html">CQL3 Type Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="hinted_handoff_design.html">Hinted Handoff Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="isolation.html">Performance Isolation in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="lua-type-mapping.html">CQL to Lua type mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">Scylla Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-users-to-roles.html">Migrating from users to roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="paged-queries.html">Paged queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_aggregations.html">Parallel aggregations</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Per-partition rate limiting</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocol-extensions.html">Protocol extensions to the Cassandra Native Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocols.html">Ports and protocols in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft-in-scylla.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft-in-scylla.html#raft-application-in-scylla">Raft application in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft-in-scylla.html#the-group-0">The group 0</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft-in-scylla.html#using-group-0-to-perform-schema-changes">Using Group 0 to perform schema changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="redis.html">Redis API in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="repair_based_node_ops.html">Repair based node operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="reverse-reads.html">Reverse reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="row_cache.html">Row Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="row_level_repair.html">Row level repair</a></li>
<li class="toctree-l2"><a class="reference internal" href="rust.html">Rust and C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="secondary_index.html">Secondary indexes in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="service_levels.html">Service Level Distributed Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstable-scylla-format.html">File format of the Scylla.db sstable component</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstables-directory-structure.html">sstables directory structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_keyspace.html">System keyspace layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_keyspace.html#virtual-tables-in-the-system-keyspace">Virtual tables in the system keyspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_schema_keyspace.html">System schema keyspace layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="wasm.html">WASM support for user-defined functions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../guides/index.html">Guides</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/api_v2.html">Scylla RESTful API V2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/building.html">Building Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/debugging.html">Debugging with GDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/docker-hub.html">Docker Hub Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/logging.html">Logging in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/virtual-tables.html">Virtual Tables</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contribute/index.html">Contribute</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../contribute/CONTRIBUTING.html">Contributing to Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/backport.html">Backport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/maintainer.html">Maintainer’s handbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/review-checklist.html">Review Checklist</a></li>
</ul>
</li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/scylla/issues/new?title=Issue in page Per-partition rate limiting&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://scylla.docs.scylladb.com/master/design-notes/per-partition-rate-limit%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                
                
                    
                        
                    
                
                <a href="https://github.com/scylladb/scylla/edit/master/docs/design-notes/per-partition-rate-limit.md"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Per-partition rate limiting</a><ul>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#server-side-configuration">Server-side configuration</a></li>
<li><a class="reference internal" href="#driver-response">Driver response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-it-works">How it works</a><ul>
<li><a class="reference internal" href="#coordinator-is-not-a-replica">Coordinator is not a replica</a></li>
<li><a class="reference internal" href="#coordinator-is-a-replica">Coordinator is a replica</a></li>
<li><a class="reference internal" href="#how-to-calculate-rejection-threshold">How to calculate rejection threshold</a></li>
<li><a class="reference internal" href="#inaccurracies">Inaccurracies</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="../_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="../_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="../_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2022, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 28 June 2022.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.2.2</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>