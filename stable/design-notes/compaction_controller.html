

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             The Compaction Controller | Scylla Docs 
        </title>
        <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../_static/img/favicon-228x228.png" />

        
            
            
        

        
            
            <link rel="canonical" href="https://scylla.docs.scylladb.com/stable/design-notes/compaction_controller.html"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="../"
            src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="../_static/underscore.js"></script>
            
        
            
                <script src="../_static/doctools.js"></script>
            
        
            
                <script src="../_static/clipboard.min.js"></script>
            
        
            
                <script src="../_static/copybutton.js"></script>
            
        
    
            <!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../_static/img/logo-docs.svg" alt="Scylla Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            Scylla Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>Scylla Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            Scylla Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Cloud <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://cloud.scylladb.com/">
                            <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">
                            <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
                            Docs</a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="../_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://scylla.docs.scylladb.com"
            class="bread__highlight">
            <i class="fas fa-home"></i> Scylla Dev
        </a>
    </span>
    
        <span class="bread__item">
            <a href="index.html">
                Design Notes
            </a>
        </span>
    
    <span class="bread__item bread__item--last">The Compaction Controller</span>
</div>
                    </div>
                
                <section id="the-compaction-controller">
<h1>The Compaction Controller<a class="headerlink" href="#the-compaction-controller" title="Permalink to this headline">¶</a></h1>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<p>The Schedulers present in Scylla–namely the I/O Scheduler and the CPU scheduler are fully capable
of enforcing resource usage between classes, like compaction and foreground reads, for instance.
Classes with more shares will use more of the resources while classes with less shares, will use
less.</p>
<p>Before the advent of the Controllers, those shares were statically determined at startup. And while
that would guarantee fairness between classes, it would not guarantee that the classes were
progressing at optimal speed.</p>
<p>Compactions could be too fast: this could be seen in compaction graphs when compaction was a visible
peak. While fast compactions are nice, ee take a lot of resources away from the foreground requests
to achieve that speed depressing latencies momentaneously. It would be better to run compactions
more slowly in that case, turning the fast peak into a better distributed plateau.</p>
<p>But blindly making compactions slower can create huge compaction backlogs, depressing future reads.
So we need to try to stay in the sweet spot.</p>
</section>
<section id="how-does-it-work">
<h2>How does it work<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h2>
<p>We will keep track of the current backlog for compaction work. The backlog is an estimate of the
amount of work that we still have to do in the future to compact everything. Because the various
compaction strategies compact things very differently and have very different ideas about what it
means for the data to be “fully compacted”, the backlogs are strategy-dependent.</p>
<p>Each Table (Column Family) keeps track of the backlog that it has, and those backlogs are then added
together to create a system-wide backlog.</p>
<p>It is expected that the backlog measurement is consistent across strategies. What this means is
that if a strategy, at a certain point in time, has more work to do than another strategy, it should
return a higher backlog.</p>
</section>
<section id="per-strategy-backlog-calculation">
<h2>Per-strategy backlog calculation<a class="headerlink" href="#per-strategy-backlog-calculation" title="Permalink to this headline">¶</a></h2>
<p>Currently unimplemented strategy will return a fixed backlog. Our aim is to soon implement backlog
controls for all classes.</p>
<section id="leveled-compaction-strategy">
<h3>Leveled Compaction Strategy<a class="headerlink" href="#leveled-compaction-strategy" title="Permalink to this headline">¶</a></h3>
<p>Unimplemented</p>
</section>
<section id="datetiered-compaction-strategy">
<h3>DateTiered Compaction Strategy<a class="headerlink" href="#datetiered-compaction-strategy" title="Permalink to this headline">¶</a></h3>
<p>Unimplemented</p>
</section>
<section id="timewindow-compaction-strategy">
<h3>TimeWindow Compaction Strategy<a class="headerlink" href="#timewindow-compaction-strategy" title="Permalink to this headline">¶</a></h3>
<p>Unimplemented</p>
</section>
<section id="sizetiered-compaction-strategy">
<h3>SizeTiered Compaction Strategy<a class="headerlink" href="#sizetiered-compaction-strategy" title="Permalink to this headline">¶</a></h3>
<p>Backlog for one SSTable under STCS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">Bi</span> <span class="o">=</span> <span class="n">Ei</span> <span class="o">*</span> <span class="n">log4</span> <span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="n">Si</span><span class="p">),</span>
</pre></div>
</div>
<p>where Ei is the effective size of the SStable, Si is the Size of this SSTable, and T is the total
size of the Table.</p>
<p>To calculate the backlog, we can use the logarithm in any base, but we choose 4 as that is the
historical minimum for the number of SSTables being compacted together. Although now that minimum
could be lifted, this is still a good number of SSTables to aim for in a compaction execution.</p>
<p>T, the total table size, is defined as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">T</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mf">0.</span><span class="o">..</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span> <span class="n">Si</span> <span class="p">}</span><span class="o">.</span>
</pre></div>
</div>
<p>Ei, the effective size, is defined as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">Ei</span> <span class="o">=</span> <span class="n">Si</span> <span class="o">-</span> <span class="n">Ci</span><span class="p">,</span>
</pre></div>
</div>
<p>where Ci is the total amount of bytes already compacted for this table.
For tables that are not under compaction, Ci = 0 and Si = Ei.</p>
<p>Using the fact that log(a / b) = log(a) - log(b), we rewrite (1) as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">Bi</span> <span class="o">=</span> <span class="n">Ei</span> <span class="n">log4</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">Ei</span> <span class="n">log4</span><span class="p">(</span><span class="n">Si</span><span class="p">)</span>
</pre></div>
</div>
<p>For the entire Table, the Aggregate Backlog (A) is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">A</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mf">0.</span><span class="o">..</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span> <span class="n">Ei</span> <span class="o">*</span> <span class="n">log4</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">Ei</span> <span class="o">*</span> <span class="n">log4</span><span class="p">(</span><span class="n">Si</span><span class="p">)</span> <span class="p">},</span>
</pre></div>
</div>
<p>which can be expressed as a sum of a table component and a SSTable component:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">A</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mf">0.</span><span class="o">..</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span> <span class="n">Ei</span> <span class="p">}</span> <span class="o">*</span> <span class="n">log4</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">Sum</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mf">0.</span><span class="o">..</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span> <span class="n">Ei</span> <span class="o">*</span> <span class="n">log4</span><span class="p">(</span><span class="n">Si</span><span class="p">)</span> <span class="p">},</span>
</pre></div>
</div>
<p>and if we define C = Sum(i = 0…N) { Ci }, then we can write</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">C</span><span class="p">)</span> <span class="o">*</span> <span class="n">log4</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">Sum</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mf">0.</span><span class="o">..</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">Si</span> <span class="o">-</span> <span class="n">Ci</span><span class="p">)</span><span class="o">*</span> <span class="n">log4</span><span class="p">(</span><span class="n">Si</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span>
</pre></div>
</div>
<p>Because the SSTable number can be quite big, we’d like to keep iterations to a minimum.  We can do
that if we rewrite the expression above one more time, yielding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">A</span> <span class="o">=</span> <span class="n">T</span> <span class="o">*</span> <span class="n">log4</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">C</span> <span class="o">*</span> <span class="n">log4</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Sum</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mf">0.</span><span class="o">..</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span> <span class="n">Si</span> <span class="o">*</span> <span class="n">log4</span><span class="p">(</span><span class="n">Si</span><span class="p">)</span> <span class="p">}</span> <span class="o">-</span> <span class="n">Sum</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mf">0.</span><span class="o">..</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span> <span class="n">Ci</span> <span class="o">*</span> <span class="n">log4</span><span class="p">(</span><span class="n">Si</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>When SSTables are added or removed, we update the static parts of the equation, and every time we
need to compute the backlog we use the most up-to-date estimate of Ci to calculate the compacted
parts, having to iterate only over the SSTables that are compacting, instead of all of them.</p>
<p>For SSTables that are being currently written, we assume that they are a full SSTable in a certain
point in time, whose size is the amount of bytes currently written. So all we need to do is keep
track of them too, and add the current estimate to the static part of (4).</p>
</section>
</section>
</section>

                
                    <div class="post-content"><div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="cdc.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />CDC
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="cql-extensions.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Scylla CQL extensions
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div></div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__versions">
    <ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
        <li class="scylla-dropdown__item">
            <a class="scylla-dropdown__title" href="#">
                
                    4.6
                
                <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
            </a>
            <ul class="menu scylla-dropdown__content">
                
                    
                
                    
                        <li>
                            <a href="compaction_controller.html">4.6</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../branch-4.5/design-notes/compaction_controller.html">4.5</a>
                        </li>
                    
                
                
            </ul>
        </li>
    </ul>
</div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Scylla Developer Documentation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../alternator/alternator.html">Alternator: DynamoDB API in Scylla</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../alternator/getting-started.html">Getting Started With ScyllaDB Alternator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alternator/compatibility.html">Scylla Alternator for DynamoDB users</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Design Notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="IDL.html">IDL compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdc.html">CDC</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">The Compaction Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql-extensions.html">Scylla CQL extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql-extensions-internal.html">Scylla CQL extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql3-type-mapping.html">CQL3 Type Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="hinted_handoff_design.html">Hinted Handoff Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="isolation.html">Performance Isolation in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="lua-type-mapping.html">CQL to Lua type mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">Scylla Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-users-to-roles.html">Migrating from users to roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="paged-queries.html">Paged queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocol-extensions.html">Protocol extensions to the Cassandra Native Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocols.html">Ports and protocols in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="redis.html">Redis API in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="repair_based_node_ops.html">Repair based node operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="reverse-reads.html">Reverse reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="row_cache.html">Row Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="row_level_repair.html">Row level repair</a></li>
<li class="toctree-l2"><a class="reference internal" href="secondary_index.html">Secondary indexes in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstable-scylla-format.html">File format of the Scylla.db sstable component</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstables-directory-structure.html">sstables directory structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_keyspace.html">System keyspace layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_schema_keyspace.html">System schema keyspace layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="wasm.html">WASM support for user-defined functions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../guides/index.html">Guides</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/HACKING.html">Guidelines for developing Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/api_v2.html">Scylla RESTful API V2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/building.html">Building Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/debugging.html">Debugging with GDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/docker-hub.html">Docker Hub Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/logging.html">Logging in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/tracing.html">Tracing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contribute/index.html">Contribute</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../contribute/CONTRIBUTING.html">Contributing to Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/backport.html">Backport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/maintainer.html">Maintainer’s handbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/review-checklist.html">Review Checklist</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../service_levels.html">Service Level Distributed Data</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/scylla/issues/new?title=Issue in page The Compaction Controller&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://scylla.docs.scylladb.com/branch-4.6/design-notes/compaction_controller%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                
                
                    
                        
                    
                
                <a href="https://github.com/scylladb/scylla/edit/branch-4.6/docs/design-notes/compaction_controller.md"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">The Compaction Controller</a><ul>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#how-does-it-work">How does it work</a></li>
<li><a class="reference internal" href="#per-strategy-backlog-calculation">Per-strategy backlog calculation</a><ul>
<li><a class="reference internal" href="#leveled-compaction-strategy">Leveled Compaction Strategy</a></li>
<li><a class="reference internal" href="#datetiered-compaction-strategy">DateTiered Compaction Strategy</a></li>
<li><a class="reference internal" href="#timewindow-compaction-strategy">TimeWindow Compaction Strategy</a></li>
<li><a class="reference internal" href="#sizetiered-compaction-strategy">SizeTiered Compaction Strategy</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="../_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="../_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="../_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2022, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 28 June 2022.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.2.2</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>